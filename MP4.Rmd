---
title: "The New Way to Get Around NYC - For Who?"
author: By Natalia Iannucci and Hana Hirano
output: 
  html_document:
    code_folding: hide
    theme: journal
    df_print: paged
---
Date: `r format(Sys.Date(), "%B %e, %Y")`  
GitHub^[https://github.com/niannucci/MP4-querying] 

![Source: Curbed New York](https://cdn.vox-cdn.com/thumbor/abPMvQOI6AYVBuDmggKP7FzMppE=/0x0:3464x2309/920x613/filters:focal(1455x878:2009x1432)/cdn.vox-cdn.com/uploads/chorus_image/image/61954281/citibike.0.jpg)

Ride sharing has been increasingly popular in recent years; but what about in metropolitan cities like New York City with constant heavy traffic? Or environmentalists looking to reduce their carbon footprint? Or, maybe you just want to get a little excersize in on your way to work. No matter your motivation, Citi Bike is a bike share system that has become popular as of late. [Citi Bikes](https://www.citibikenyc.com/about) are specifically labeled bikes locked into hundreds of stations around New York City; they can be returned to any station, and are available at all times. A corresponding app is used to unlock a bike, and pay for your ride. The distance of each ride is recorded, as well as which station it was taken from and returned to and the age of the user, allowing us to examine factors that are involved in the biking world.

```{r message = FALSE, warning = FALSE}
library(tidyverse)
library(ggthemes)
library(RMySQL)
library(DBI)
db <- dbConnect(MySQL(), 
                host = "scidb.smith.edu", 
                user = "mth292", 
                password = "RememberPi", 
                dbname = "citibike")
knitr::opts_chunk$set(connection = db, max.print = 20)
```

While the Citi Bike station with the longest average duration also has the youngest average age of its users, the other stations quickly taper off and show no significant difference in average ride duration based on age.
```{r message = FALSE, warning = FALSE}
women <- dbGetQuery(db, 
"SELECT gender, AVG(t.duration / 60) AS avg_duration_in_min, AVG(2019 - t.birth_year) AS avg_age, name
FROM trips AS t
LEFT JOIN station_months 
	ON station_months.station_id = t.start_station_id
WHERE gender = 2
	AND start_time LIKE '2017-01%'
GROUP BY name
HAVING avg_age < 100
ORDER BY avg_duration_in_min DESC
LIMIT 0, 20"
)
```

```{r message = FALSE, warning = FALSE}
women_graph <- ggplot(women, aes(x = avg_age, y = avg_duration_in_min)) +
  ggtitle("Top 20 Longest Average Station Rides for Women") +
  geom_point(alpha = 0.8) +
  xlab("Average Age of Citi Bike User") +
  ylab("Average Ride Duration (Min)") +
  theme_solarized() +
  geom_smooth()

women_graph
```

Similarly to women, the Citi Bike station with the longest average duration also has the youngest average age of its male users, and also show no significant difference in biking duration based on the factor of age.
```{r message = FALSE, warning = FALSE}
men <- dbGetQuery(db, 
"SELECT gender, AVG(t.duration / 60) AS avg_duration_in_min, AVG(2019 - t.birth_year) AS avg_age, name
FROM trips AS t
LEFT JOIN station_months 
	ON station_months.station_id = t.start_station_id
WHERE gender = 1
	AND start_time LIKE '2017-01%'
GROUP BY name
HAVING avg_age < 100
ORDER BY avg_duration_in_min DESC
LIMIT 0, 20"
)
```

```{r message = FALSE, warning = FALSE}
men_graph <- ggplot(men, aes(x = avg_age, y = avg_duration_in_min)) +
  ggtitle("Top 20 Longest Average Station Rides for Men") +
  geom_point(alpha = 0.8) +
  xlab("Average Age of Citi Bike User") +
  ylab("Average Ride Duration (Min)") +
  theme_solarized() +
  geom_smooth()

men_graph
```

this shows the relationship between their age and duration of their ride
```{r message = FALSE, warning = FALSE}
duration_age <- dbGetQuery(db, 
"SELECT (t.duration / 60) AS duration_in_min, (2019 - t.birth_year) AS age
FROM trips AS t
WHERE t.birth_year > 1919
GROUP BY age
ORDER BY age"
)
```


> Word count: `r wordcountaddin::word_count()`